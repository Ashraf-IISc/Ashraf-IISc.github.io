<!DOCTYPE html>
<html>
<head>
    <title>Activity Tracker</title>
    <style>
        body { font-family: monospace; background-color: #0d1117; color: #c9d1d9; padding: 2rem; }
        .grid { display: flex; flex-wrap: wrap; gap: 5px; max-width: 600px; margin-top: 20px; }
        .day { width: 30px; height: 30px; border-radius: 4px; cursor: pointer; display: flex; justify-content: center; align-items: center; }
        
        /* GitHub-style Heatmap Colors based on score (0-6) */
        .score-0 { background-color: #161b22; }
        .score-1 { background-color: #0e4429; }
        .score-2 { background-color: #006d32; }
        .score-3 { background-color: #26a641; }
        .score-4 { background-color: #39d353; }
        .score-5 { background-color: #46f866; }
        .score-6 { background-color: #afffbd; }

        .has-blog::after { content: "â˜…"; color: white; font-size: 10px; }
        
        /* Popup Modal */
        #modal { display: none; position: fixed; top: 20%; left: 30%; background: #252525; padding: 20px; border: 1px solid #00ff9d; }
        textarea { width: 100%; height: 100px; background: #000; color: #fff; border: 1px solid #555; }
        button { background: #00ff9d; color: #000; padding: 5px 10px; border: none; cursor: pointer; margin-top: 10px; }
    </style>
</head>
<body>
    <h2>Priority Heatmap (Last 30 Days)</h2>
    
    <div class="grid">
        {% for day in days %}
            {% set data = log_dict.get(day, {'score': 0, 'has_blog': 0, 'blog_text': ''}) %}
            <div class="day score-{{ data.score }} {% if data.has_blog %}has-blog{% endif %}" 
                 onclick="openModal('{{ day }}', {{ data.score }}, {{ data.has_blog }}, '{{ data.blog_text | replace('\n', '\\n') | escape }}')"
                 title="{{ day }}">
            </div>
        {% endfor %}
    </div>

    <div id="modal">
        <h3 id="modal-date"></h3>
        <form action="/update" method="POST">
            <input type="hidden" name="date" id="input-date">
            <label>Score (0-6): <input type="number" name="score" id="input-score" min="0" max="6" required></label><br><br>
            <label><input type="checkbox" name="has_blog" id="input-blog-check"> Include Blog Entry</label><br><br>
            <textarea name="blog_text" id="input-blog-text" placeholder="Write your daily entry here..."></textarea><br>
            <button type="submit">Save</button>
            <button type="button" onclick="document.getElementById('modal').style.display='none'" style="background: #555; color: white;">Cancel</button>
        </form>
    </div>

    <script>
        function openModal(date, score, hasBlog, blogText) {
            document.getElementById('modal').style.display = 'block';
            document.getElementById('modal-date').innerText = "Log for: " + date;
            document.getElementById('input-date').value = date;
            document.getElementById('input-score').value = score;
            document.getElementById('input-blog-check').checked = hasBlog === 1;
            document.getElementById('input-blog-text').value = blogText;
        }
    </script>
</body>
</html>